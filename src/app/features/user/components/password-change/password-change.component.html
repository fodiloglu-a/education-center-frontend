<!-- password-change.component.html -->

<div class="password-change-container">
  <!-- Yükleme Spinner'ı -->
  <app-loading-spinner *ngIf="isLoading"></app-loading-spinner>

  <!-- Hata Mesajı -->
  <app-alert-dialog *ngIf="errorMessage" [message]="errorMessage" type="error" [autoClose]="true" (closed)="clearMessages()"></app-alert-dialog>

  <!-- Başarı Mesajı -->
  <app-alert-dialog *ngIf="successMessage" [message]="successMessage" type="success" [autoClose]="true" (closed)="clearMessages()"></app-alert-dialog>

  <div class="password-change-card" *ngIf="!isLoading && userId">
    <h2 class="card-title">{{ 'CHANGE_PASSWORD' | translate }}</h2>
    <p class="card-subtitle">{{ 'CHANGE_PASSWORD_SUBTITLE' | translate }}</p>

    <form [formGroup]="passwordChangeForm" (ngSubmit)="onSubmit()" class="password-change-form">
      <!-- Eski Şifre Alanı -->
      <div class="form-group">
        <label for="oldPassword">{{ 'OLD_PASSWORD' | translate }}</label>
        <input type="password" id="oldPassword" formControlName="oldPassword" class="form-control"
               [class.is-invalid]="oldPassword?.invalid && (oldPassword?.dirty || oldPassword?.touched)"
               placeholder="{{ 'OLD_PASSWORD_PLACEHOLDER' | translate }}">
        <div *ngIf="oldPassword?.invalid && (oldPassword?.dirty || oldPassword?.touched)" class="invalid-feedback">
          <div *ngIf="oldPassword?.errors?.['required']">{{ 'OLD_PASSWORD_REQUIRED' | translate }}</div>
        </div>
      </div>

      <!-- Yeni Şifre Alanı -->
      <div class="form-group">
        <label for="newPassword">{{ 'NEW_PASSWORD' | translate }}</label>
        <input type="password" id="newPassword" formControlName="newPassword" class="form-control"
               [class.is-invalid]="newPassword?.invalid && (newPassword?.dirty || newPassword?.touched)"
               placeholder="{{ 'NEW_PASSWORD_PLACEHOLDER' | translate }}">
        <div *ngIf="newPassword?.invalid && (newPassword?.dirty || newPassword?.touched)" class="invalid-feedback">
          <div *ngIf="newPassword?.errors?.['required']">{{ 'NEW_PASSWORD_REQUIRED' | translate }}</div>
          <div *ngIf="newPassword?.errors?.['minlength']">{{ 'PASSWORD_MIN_LENGTH' | translate: '{min: 6}' }}</div>
        </div>
      </div>

      <!-- Yeni Şifre Tekrarı Alanı -->
      <div class="form-group">
        <label for="confirmNewPassword">{{ 'CONFIRM_NEW_PASSWORD' | translate }}</label>
        <input type="password" id="confirmNewPassword" formControlName="confirmNewPassword" class="form-control"
               [class.is-invalid]="confirmNewPassword?.invalid && (confirmNewPassword?.dirty || confirmNewPassword?.touched)"
               placeholder="{{ 'CONFIRM_NEW_PASSWORD_PLACEHOLDER' | translate }}">
        <div *ngIf="confirmNewPassword?.invalid && (confirmNewPassword?.dirty || confirmNewPassword?.touched)" class="invalid-feedback">
          <div *ngIf="confirmNewPassword?.errors?.['required']">{{ 'CONFIRM_NEW_PASSWORD_REQUIRED' | translate }}</div>
          <div *ngIf="confirmNewPassword?.errors?.['mismatch']">{{ 'PASSWORDS_DO_NOT_MATCH' | translate }}</div>
        </div>
      </div>

      <!-- Kaydet Butonu -->
      <button type="submit" class="submit-button primary-btn" [disabled]="passwordChangeForm.invalid || isLoading">
        <span *ngIf="!isLoading">{{ 'CHANGE_PASSWORD_BUTTON' | translate }}</span>
        <span *ngIf="isLoading" class="spinner"></span> <!-- Yükleme göstergesi -->
      </button>
    </form>

    <p class="back-link">
      <a routerLink="/profile">{{ 'BACK_TO_PROFILE' | translate }}</a>
    </p>
  </div>

  <div *ngIf="!isLoading && !userId && !errorMessage" class="no-user-found">
    <p>{{ 'USER_NOT_LOADED' | translate }}</p>
    <button class="action-button primary-btn" routerLink="/auth/login">{{ 'LOGIN_NOW' | translate }}</button>
  </div>
</div>
